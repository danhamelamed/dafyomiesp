<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daf Yomi por Daniel Hamelamed - Guayaquil Ecuador</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .hebrew {
      direction: rtl;
      font-weight: bold;
      font-family: "David Libre", serif;
    }
    .floating-progress {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #e5e7eb;
      z-index: 50;
    }
    .progress-bar {
      height: 6px;
      background-color: #2563eb;
    }
  </style>
</head>

<body class="bg-gray-100">
  <div class="floating-progress">
    <div id="progressBar" class="progress-bar" style="width: 0%"></div>
  </div>

  <header class="text-center p-4 bg-white shadow">
    <h1 class="text-xl font-bold">Daf Yomi por Daniel Hamelamed - Guayaquil Ecuador</h1>
    <div class="text-[10px] text-gray-400 whitespace-nowrap overflow-hidden">
      <span class="inline-block animate-marquee">
        Zeraim Nashim Nezikin Kodashim Taharot Moed Zeraim Nashim Nezikin Kodashim Taharot Moed Zeraim Nashim Nezikin Kodashim Taharot Moed
      </span>
    </div>
  </header>

  <main class="max-w-2xl mx-auto p-4">
    <div class="flex gap-2 mb-4">
      <select id="masechetSelect" class="p-2 rounded border border-gray-300">
        <option>Brajot</option>
        <option>Shabat</option>
        <option>Eruvin</option>
        <option>Pesajim</option>
        <option>Shekalim</option>
        <option>Yoma</option>
        <option>Suca</option>
        <option>Beitza</option>
        <option>Rosh Hashaná</option>
        <option>Ta'anit</option>
        <option>Meguilá</option>
        <option>Moed Katan</option>
        <option>Jaguigá</option>
        <option>Yevamot</option>
        <option>Ketuvot</option>
        <option>Nedarin</option>
        <option>Nazir</option>
        <option>Sotá</option>
        <option>Guitin</option>
        <option>Kidushin</option>
        <option>Baba Kama</option>
        <option>Baba Metzia</option>
        <option>Baba Batra</option>
        <option>Sanedrín</option>
      </select>
      <input id="dafInput" type="number" class="w-20 p-2 rounded border border-gray-300" placeholder="Daf" value="2">
      <button onclick="loadFirstLines()" class="px-4 py-2 bg-blue-600 text-white rounded">Cargar</button>
    </div>

    <div id="content" class="space-y-6"></div>
    <button onclick="nextLines()" class="mt-8 block mx-auto px-4 py-2 bg-green-600 text-white rounded">Siguiente línea</button>
  </main>

  <script>
    let currentLines = [];
    let currentIndex = 0;
    let selectedMasechet = '';
    let selectedDaf = '';

    async function loadFirstLines() {
      selectedMasechet = document.getElementById('masechetSelect').value;
      selectedDaf = document.getElementById('dafInput').value;

      const response = await fetch(`https://www.sefaria.org/api/texts/${selectedMasechet}.${selectedDaf}?lang=he`);
      const data = await response.json();

      const rawLines = Array.isArray(data.he) ? data.he : [];
      const lines = rawLines.filter(line => typeof line === 'string' && line.trim() !== '');

      currentLines = lines;
      currentIndex = 0;
      document.getElementById('content').innerHTML = '';
      nextLines();
    }

    async function nextLines() {
      const contentDiv = document.getElementById('content');
      const line1 = currentLines[currentIndex] || '';
      const line2 = currentLines[currentIndex + 1] || '';
      currentIndex += 2;

      const response = await fetch('https://dafyomi-api.danfuenteslopez.workers.dev/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          prompt: `Explica y traduce en español estas dos líneas del Talmud ${selectedMasechet} ${selectedDaf}:\n\n${line1}\n${line2}`
        })
      });

      const result = await response.json();
      const explanation = result.text || 'No se pudo generar explicación.';

      const block = document.createElement('div');
      block.innerHTML = `
        <div class="hebrew text-right text-lg">${line1}<br>${line2}</div>
        <div class="mt-2">${explanation}</div>
      `;

      contentDiv.appendChild(block);

      const progress = Math.min((currentIndex / currentLines.length) * 100, 100);
      document.getElementById('progressBar').style.width = progress + '%';
    }
  </script>
</body>
</html>
